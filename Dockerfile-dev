# Use Node.js LTS version
FROM node:18-alpine

# Set working directory
WORKDIR /app

# Install production dependencies only
COPY package.json yarn.lock ./
RUN yarn install --production --frozen-lockfile

# Copy the built application
COPY dist/ ./dist/

# Copy configuration file
COPY docker-config-dev.yaml ./

# Create directory for database (will be mounted as volume)
RUN mkdir -p /app/data

# Expose the port (default 8000, can be overridden by config)
EXPOSE 8000

# Set default environment variables
ENV CONFIG_FILE="./config-dev.yaml"
ENV NODE_ENV="production"

# Start the application
CMD ["node", "dist/server/AppServer.js"]
